// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Location {
  id String @id @default(cuid())
  
  // Core location data
  name              String   // "Brentwood Buddies"
  full_address      String   // "Brentwood Buddies, College Station, TX"
  city              String?  // "College Station"
  state             String?  // "TX"
  country           String?  // "USA"
  
  // Coordinates
  latitude          Float?
  longitude         Float?
  
  // User preferences
  is_favorite       Boolean @default(false)
  is_private        Boolean @default(true)  // Don't share in exports
  nickname          String? // User's custom name for this location
  
  // Usage tracking
  usage_count       Int @default(0)
  last_used_at      DateTime?
  
  // Metadata
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  
  // Relations
  sessions          ConsumptionSession[]
  
  // Indexes for performance
  @@index([name])
  @@index([is_favorite])
  @@index([usage_count])
  @@map("locations")
}

model ConsumptionSession {
  id String @id @default(cuid())

  // Core Fields
  date              String
  time              String
  
  // Legacy location fields (keeping for backward compatibility)
  location          String?   // Optional legacy field
  latitude          Float?    // Optional legacy field  
  longitude         Float?    // Optional legacy field
  
  // Primary location relationship (optional for legacy data)
  location_id       String?
  location_ref      Location? @relation(fields: [location_id], references: [id])
  who_with          String
  vessel_category   String    // Main category: Bong, Pipe, Joint, Pen, Edible, etc.
  vessel            String    // Specific item: Simba, Classic Bubbler, Vibes: 1.25...
  accessory_used    String
  my_vessel         Boolean @default(true)
  my_substance      Boolean @default(true)
  strain_name       String
  thc_percentage    Float?
  purchased_legally Boolean @default(true)
  state_purchased   String?
  tobacco           String? // Can be "None", "Lucky Strike Red 100s Tobacco", "American Sport Cigs Blue", "American Spirit Menthol", or custom
  kief              Boolean @default(false)
  concentrate       Boolean @default(false)
  lavender          Boolean @default(false)

  // Strain information
  strain_type       String? // "Indica", "Sativa", "Hybrid"

  // User notes and comments
  comments          String?

  // Quantity system - stored as JSON for flexibility
  // Contains: { amount: number, unit: string, type: string }
  quantity String // JSON string

  // Legacy support - for data migration
  quantity_legacy Float?

  // Metadata
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  images Image[]

  @@map("consumption_sessions")
}

model Image {
  id String @id @default(cuid())
  
  // Session relationship (optional for temporary images)
  session_id String?
  session ConsumptionSession? @relation(fields: [session_id], references: [id], onDelete: Cascade)
  
  // Vercel Blob storage reference
  blob_url String // Vercel Blob URL
  filename String
  file_size Int
  mime_type String
  
  // Image metadata
  width Int?
  height Int?
  alt_text String? // For accessibility
  
  // Privacy and metadata
  created_at DateTime @default(now())
  
  // Indexes for performance
  @@index([session_id])
  @@map("session_images")
}

model Feedback {
  id         String   @id @default(cuid())
  content    String
  images_json Json?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([updated_at])
  @@map("feedback")
}
