// Enhanced schema with normalized locations table
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Location {
  id String @id @default(cuid())
  
  // Core location data
  name              String   // "Brentwood Buddies"
  full_address      String   // "Brentwood Buddies, College Station, TX"
  city              String?  // "College Station"
  state             String?  // "TX"
  country           String?  // "USA"
  
  // Coordinates
  latitude          Float?
  longitude         Float?
  
  // User preferences
  is_favorite       Boolean @default(false)
  is_private        Boolean @default(true)  // Don't share in exports
  nickname          String? // User's custom name for this location
  
  // Usage tracking
  usage_count       Int @default(0)
  last_used_at      DateTime?
  
  // Metadata
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  
  // Relations
  sessions          ConsumptionSession[]
  
  // Indexes for performance
  @@index([name])
  @@index([is_favorite])
  @@index([usage_count])
  @@map("locations")
}

model ConsumptionSession {
  id String @id @default(cuid())

  // Core Fields
  date              String
  time              String
  
  // Location relationship (replaces location string + lat/lng)
  location_id       String?
  location          Location? @relation(fields: [location_id], references: [id])
  
  // Legacy location support (for migration period)
  location_legacy   String?
  latitude_legacy   Float?
  longitude_legacy  Float?
  
  who_with          String
  vessel            String
  accessory_used    String
  my_vessel         Boolean @default(true)
  my_substance      Boolean @default(true)
  strain_name       String
  thc_percentage    Float?
  purchased_legally Boolean @default(true)
  state_purchased   String?
  tobacco           Boolean @default(false)
  kief              Boolean @default(false)
  concentrate       Boolean @default(false)
  lavender          Boolean @default(false)

  // Strain information
  strain_type       String? // "Indica", "Sativa", "Hybrid"

  // User notes and comments
  comments          String?

  // Quantity system - stored as JSON for flexibility
  quantity String // JSON string

  // Legacy support - for data migration
  quantity_legacy Float?

  // Metadata
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("consumption_sessions")
}
